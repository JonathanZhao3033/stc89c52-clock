C51 COMPILER V9.01   DIGDISPLAY                                                            11/05/2019 11:31:54 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE DIGDISPLAY
OBJECT MODULE PLACED IN digdisplay.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE digdisplay.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "reg52.h"
   2          #define FLAGUS 10        //用于定时模式1 
   3          #define WEI 8   
   4          
   5          
   6          typedef unsigned int u16;
   7          typedef unsigned char u8;
   8          
   9          //使用138译码器
  10          sbit LSA = P2 ^ 2;
  11          sbit LSB = P2 ^ 3;
  12          sbit LSC = P2 ^ 4;
  13          
  14          u16 flag = 0;        //定时器标志位
  15          
  16          u8 i;
  17          u8 s0 = 0, s1 = 0, s2 = 5, s3 = 5, s4 = 9, s5 = 5, s6 = 3 , s7 = 2;
  18          
  19          
  20          void delayus(u16 value);            //value = 1 时，大约延时1us。
  21          
  22          void opentimer0(void);                  //开启定时器0
  23          
  24          
  25          u8 duanxian[] = {0x3f, 0x06, 0x5b, 0x4f, 0x66, 0x6d, 0x7d, 0x07,
  26                           0x7f, 0x6f, 0x77, 0x7c, 0x39, 0x5e, 0x79, 0x71
  27                          };
  28          
  29          void main(void)
  30          {
  31   1          opentimer0();
  32   1          while(1)
  33   1          {
  34   2              if(flag >= FLAGUS)
  35   2              {
  36   3                  flag = 0;
  37   3                  s0++;
  38   3                  if(s0 >= 10)
  39   3                  {   s0 = 0;
  40   4                      s1++;
  41   4                  }
  42   3                  if(s1 >= 10)
  43   3                  {
  44   4                      s1 = 0;
  45   4                      s2++;
  46   4                  }
  47   3                  if(s2 >= 10)
  48   3                  {   s2 = 0;
  49   4                      s3++;
  50   4                  }
  51   3                  if(s3 >= 6)
  52   3                  {   
  53   4                                      s3 = 0;
  54   4                                      s4++;
  55   4                              }
C51 COMPILER V9.01   DIGDISPLAY                                                            11/05/2019 11:31:54 PAGE 2   

  56   3      
  57   3                              if(s4 >= 10)
  58   3                  {   s4 = 0;
  59   4                      s5++;
  60   4                  }
  61   3                  if(s5 >= 6)
  62   3                  {
  63   4                      s5 = 0;
  64   4                      s6++;
  65   4                  }
  66   3                               if(s6 >= 4)
  67   3                  {   s6 = 0;
  68   4                      s7++;
  69   4                  }
  70   3                  if(s7 >= 3)
  71   3                  {
  72   4                      s7 = 0;
  73   4                    
  74   4                  }
  75   3              }
  76   2      
  77   2              for(i = 0; i < WEI; ++i)
  78   2              {
  79   3                  switch(i)
  80   3                  {
  81   4                  case (0):
  82   4                      LSA = 0;
  83   4                      LSB = 0;
  84   4                      LSC = 0; //显示第0位
  85   4                      P0 = duanxian[s0];
  86   4                      delayus(1);
  87   4                      P0 = 0x00;
  88   4                      break;
  89   4      
  90   4                  case(1):
  91   4                      LSA = 1;
  92   4                      LSB = 0;
  93   4                      LSC = 0; //显示第1位
  94   4                      P0 = duanxian[s1];
  95   4                      delayus(1);
  96   4                      P0 = 0x00;
  97   4                      break;
  98   4                  case(2):
  99   4                      LSA = 0;
 100   4                      LSB = 1;
 101   4                      LSC = 0; //显示第2位
 102   4                      P0 = duanxian[s2];
 103   4                      delayus(1);
 104   4                      P0 = 0x00;
 105   4                      break;
 106   4                  case(3):
 107   4                      LSA = 1;
 108   4                      LSB = 1;
 109   4                      LSC = 0; //显示第3位
 110   4                      P0 = duanxian[s3];
 111   4                      delayus(1);
 112   4                      P0 = 0x00;
 113   4                      break;
 114   4                              case(4):
 115   4                                      LSA=0;LSB=0;LSC=1;
 116   4                                      P0 = duanxian[s4];
 117   4                      delayus(1);
C51 COMPILER V9.01   DIGDISPLAY                                                            11/05/2019 11:31:54 PAGE 3   

 118   4                      P0 = 0x00;
 119   4                                      break;//显示第4位
 120   4                              case(5):
 121   4                                      LSA=1;LSB=0;LSC=1;
 122   4                                      P0 = duanxian[s5];
 123   4                      delayus(1);
 124   4                      P0 = 0x00;
 125   4                                      break;//显示第5位
 126   4                              case(6):
 127   4                                      LSA=0;LSB=1;LSC=1;
 128   4                                              P0 = duanxian[s6];
 129   4                      delayus(1);
 130   4                      P0 = 0x00;
 131   4                                       break;//显示第6位
 132   4                              case(7):
 133   4                                      LSA=1;LSB=1;LSC=1; 
 134   4                                              P0 = duanxian[s7];
 135   4                      delayus(1);
 136   4                      P0 = 0x00;
 137   4                                      break;//显示第7位
 138   4                  }
 139   3      
 140   3              }
 141   2          }
 142   1      }
 143          
 144          void delayus(u16 value)
 145          {
 146   1          u8 i, j;
 147   1          for(i = 0; i < 1; i++)
 148   1              for(j = 0; j < value; j++);
 149   1      }
 150          
 151          void opentimer0(void)       //定时器0初始化
 152          {
 153   1          TMOD = 0x01;                         //模式1
 154   1          TH0 = 0xfc;
 155   1          TL0 = 0x20;           //初值，定时10us
 156   1          EA = 1;
 157   1          ET0 = 1;
 158   1          TR0 = 1;
 159   1      }
 160          
 161          void int0() interrupt 1           //定时器0处理函数
 162          {
 163   1          TH0 = 0xfc;
 164   1          TL0 = 0x20;
 165   1          flag ++;
 166   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    332    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     27    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
